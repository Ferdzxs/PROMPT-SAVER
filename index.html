<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prompt Saver</title>
<style>
* {
  box-sizing: border-box;
  font-family: Arial, Helvetica, sans-serif;
}
body {
  margin: 0;
  background: black;
  color: white;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.toggle {
  margin-top: 30px;
  display: flex;
  border: 2px solid white;
}
.toggle button {
  background: none;
  border: none;
  color: white;
  padding: 10px 40px;
  cursor: pointer;
}
.toggle .active {
  background: white;
  color: black;
}
h1 {
  margin: 40px 0 20px;
  letter-spacing: 2px;
}
.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  flex-wrap: wrap;
  justify-content: center;
}
.controls input {
  width: 260px;
  height: 40px;
  background: black;
  border: 2px solid white;
  color: white;
  padding: 0 10px;
}
.controls button {
  width: 40px;
  height: 40px;
  background: black;
  border: 2px solid white;
  color: white;
  font-size: 24px;
  cursor: pointer;
}
.grid {
  width: 80%;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 30px;
}
.card {
  border: 2px solid white;
  min-height: 200px;
  padding: 15px;
  white-space: pre-wrap;
  cursor: pointer;
  position: relative;
  padding-bottom: 45px;
  display: flex;
  flex-direction: column;
}
.card.expanded {
  height: auto;
}
.card:hover {
  background: rgba(255,255,255,0.05);
}
.card.copied::after {
  content: "COPIED";
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  opacity: 0.8;
}
.card-date {
  font-size: 11px;
  color: #888;
  margin-bottom: 8px;
}
.card-text {
  overflow: hidden;
  word-wrap: break-word;
  flex: 1;
}
.card-text.collapsed {
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
  max-height: 120px;
}
.card-text.expanded {
  display: block;
  max-height: none;
  overflow-y: auto;
}
.card-actions {
  position: absolute;
  bottom: 10px;
  left: 15px;
  right: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.see-more {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 12px;
  text-decoration: underline;
  padding: 0;
}
.delete-btn {
  background: none;
  border: 1px solid white;
  color: white;
  cursor: pointer;
  font-size: 12px;
  padding: 5px 10px;
  transition: all 0.3s;
  opacity: 0;
  pointer-events: none;
}
.card:hover .delete-btn {
  opacity: 1;
  pointer-events: auto;
}
.delete-btn:hover {
  background: white;
  color: black;
}
@media (max-width: 768px) {
  .grid {
    grid-template-columns: 1fr;
    width: 90%;
  }
}
</style>
</head>
<body>
<div class="toggle">
  <button class="active">PS</button>
  <button>OTHER</button>
</div>
<h1>PROMPT SAVER</h1>
<div class="controls">
  <input id="searchInput" placeholder="Search prompts or date...">
  <input id="promptInput" placeholder="Add new prompt...">
  <button id="addBtn">+</button>
</div>
<div class="grid" id="grid"></div>
<script>
const grid = document.getElementById("grid")
const promptInput = document.getElementById("promptInput")
const searchInput = document.getElementById("searchInput")
const addBtn = document.getElementById("addBtn")
let prompts = []

async function loadPrompts() {
  try {
    const result = await window.storage.get('prompts')
    prompts = result ? JSON.parse(result.value) : []
    renderPrompts(searchInput.value)
  } catch (error) {
    prompts = []
    renderPrompts(searchInput.value)
  }
}

async function savePrompts() {
  try {
    await window.storage.set('prompts', JSON.stringify(prompts))
  } catch (error) {
    console.error('Save failed:', error)
  }
}

function formatDate(timestamp) {
  const date = new Date(timestamp)
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
  const month = months[date.getMonth()]
  const day = date.getDate()
  const year = date.getFullYear()
  let hours = date.getHours()
  const minutes = date.getMinutes().toString().padStart(2, '0')
  const ampm = hours >= 12 ? 'PM' : 'AM'
  hours = hours % 12 || 12
  return `${month} ${day}, ${year} at ${hours}:${minutes} ${ampm}`
}

function renderPrompts(filter = "") {
  grid.innerHTML = ""
  prompts
    .filter(p => {
      const textMatch = p.text.toLowerCase().includes(filter.toLowerCase())
      const dateMatch = formatDate(p.date).toLowerCase().includes(filter.toLowerCase())
      return textMatch || dateMatch
    })
    .forEach((prompt, index) => {
      const card = document.createElement("div")
      card.className = "card"
      
      const dateDiv = document.createElement("div")
      dateDiv.className = "card-date"
      dateDiv.textContent = formatDate(prompt.date)
      
      const textDiv = document.createElement("div")
      textDiv.className = "card-text"
      textDiv.textContent = prompt.text
      
      const isLong = prompt.text.length > 150
      if (isLong) {
        textDiv.classList.add("collapsed")
      }
      
      const actions = document.createElement("div")
      actions.className = "card-actions"
      
      if (isLong) {
        const seeMoreBtn = document.createElement("button")
        seeMoreBtn.className = "see-more"
        seeMoreBtn.textContent = "See more"
        seeMoreBtn.onclick = (e) => {
          e.stopPropagation()
          if (textDiv.classList.contains("collapsed")) {
            textDiv.classList.remove("collapsed")
            textDiv.classList.add("expanded")
            card.classList.add("expanded")
            seeMoreBtn.textContent = "See less"
          } else {
            textDiv.classList.add("collapsed")
            textDiv.classList.remove("expanded")
            card.classList.remove("expanded")
            seeMoreBtn.textContent = "See more"
          }
        }
        actions.appendChild(seeMoreBtn)
      } else {
        actions.appendChild(document.createElement("span"))
      }
      
      const deleteBtn = document.createElement("button")
      deleteBtn.className = "delete-btn"
      deleteBtn.textContent = "Delete"
      deleteBtn.onclick = async (e) => {
        e.stopPropagation()
        const originalIndex = prompts.findIndex(p => p.date === prompt.date && p.text === prompt.text)
        prompts.splice(originalIndex, 1)
        await savePrompts()
        renderPrompts(searchInput.value)
      }
      actions.appendChild(deleteBtn)
      
      card.appendChild(dateDiv)
      card.appendChild(textDiv)
      card.appendChild(actions)
      
      card.onclick = async (e) => {
        if (e.target === card || e.target === textDiv || e.target === dateDiv) {
          try {
            await navigator.clipboard.writeText(prompt.text)
            card.classList.add("copied")
            setTimeout(() => card.classList.remove("copied"), 800)
          } catch (err) {
            const textarea = document.createElement('textarea')
            textarea.value = prompt.text
            textarea.style.position = 'fixed'
            textarea.style.opacity = '0'
            document.body.appendChild(textarea)
            textarea.select()
            document.execCommand('copy')
            document.body.removeChild(textarea)
            card.classList.add("copied")
            setTimeout(() => card.classList.remove("copied"), 800)
          }
        }
      }
      
      grid.appendChild(card)
    })
}

addBtn.onclick = async () => {
  const text = promptInput.value.trim()
  if (!text) return
  prompts.unshift({
    text: text,
    date: Date.now()
  })
  await savePrompts()
  promptInput.value = ""
  renderPrompts(searchInput.value)
}

promptInput.onkeydown = e => {
  if (e.key === "Enter") addBtn.click()
}

searchInput.oninput = e => {
  renderPrompts(e.target.value)
}

loadPrompts()
</script>
</body>
</html>
